extends Node

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã (–Ω–∞ –Ω–∏—Ö –ø–æ–¥–ø–∏—à—É—Ç—Å—è –≤—Å–µ: UI, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, –∫–∞–ª–µ–Ω–¥–∞—Ä—å)
signal time_tick(hour, minute)
signal day_started(day_number)
signal day_ended # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–Ω–∞ –∏–≥—Ä–æ–∫–∞

# --- –ù–û–í–´–ï –°–ò–ì–ù–ê–õ–´ –î–õ–Ø AI ---
signal work_started # –°—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 09:00
signal work_ended   # –°—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 18:00

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
# –Ø –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ—Å—Ç–∞–≤–∏–ª 5.0, —á—Ç–æ–±—ã —Ç—ã –Ω–µ –∂–¥–∞–ª –º–∏–Ω—É—Ç—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–¥–∏ 1 –º–∏–Ω—É—Ç—ã –≤ –∏–≥—Ä–µ.
# –ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –¥–æ–≤–æ–ª–µ–Ω —Å–∫–æ—Ä–æ—Å—Ç—å—é - –≤–µ—Ä–Ω–∏ –Ω–∞ 1 –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π –ø–æ–¥ —Å–µ–±—è.
const MINUTES_PER_REAL_SECOND = 1.0 

const START_HOUR = 9  # –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã (–∏–∑–º–µ–Ω–∏–ª —Å 8 –Ω–∞ 9 –ø–æ –¢–ó)
const END_HOUR = 18   # –ö–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã

# –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
var day = 1
var hour = 8 # –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É –≤ 08:00 (–∑–∞ —á–∞—Å –¥–æ —Ä–∞–±–æ—Ç—ã)
var minute = 0

var time_accumulator = 0.0 # –°—é–¥–∞ –∫–æ–ø–∏–º –¥–æ–ª–∏ —Å–µ–∫—É–Ω–¥

func _process(delta):
	# –ü—Ä–∏–±–∞–≤–ª—è–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∫ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä—É
	time_accumulator += delta * MINUTES_PER_REAL_SECOND
	
	# –ï—Å–ª–∏ –Ω–∞–±–µ–∂–∞–ª–∞ —Ü–µ–ª–∞—è –º–∏–Ω—É—Ç–∞ (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
	while time_accumulator >= 1.0:
		minute += 1
		time_accumulator -= 1.0
		
		# –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ —á–∞—Å–æ–≤
		if minute >= 60:
			minute = 0
			hour += 1
			
			# --- [–ù–û–í–û–ï] –ü–†–û–í–ï–†–ö–ê –†–ê–°–ü–ò–°–ê–ù–ò–Ø ---
			# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–≤–Ω–æ –≤ –º–æ–º–µ–Ω—Ç —Å–º–µ–Ω—ã —á–∞—Å–∞
			if hour == START_HOUR:
				emit_signal("work_started")
				print("üîî 09:00: –°–¢–ê–†–¢ –†–ê–ë–û–¢–´")
				
			elif hour == END_HOUR:
				emit_signal("work_ended")
				print("üîî 18:00: –ö–û–ù–ï–¶ –†–ê–ë–û–¢–´")
			
			# –ù–æ–≤—ã–π –¥–µ–Ω—å
			if hour >= 24:
				hour = 0
				day += 1
				emit_signal("day_started", day)
				GameState.pay_daily_salaries()
		
		# –°–æ–æ–±—â–∞–µ–º –≤—Å–µ–º, —Å–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å –≤—Ä–µ–º–µ–Ω–∏
		emit_signal("time_tick", hour, minute)
